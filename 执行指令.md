# ACGStation 游戏文件同步器 - 执行指令

## 项目概述

这是一个基于Tauri + React + TypeScript + shadcn/ui 构建的游戏文件同步器应用程序。主要功能包括：

- 🎮 游戏文件导出管理
- 📁 文件夹浏览和预览
- ✅ 多选文件/文件夹功能
- 🗜️ 智能压缩选项（可选择文件夹是否压缩导出）
- 📦 生成包含清单的ZIP导出包
- 🔐 文件SHA256哈希计算
- 📋 JSON清单生成（包含文件信息、下载链接、版本等）

## 系统要求

- Node.js 16+
- Rust 1.70+
- Tauri CLI

## 安装和运行指令

### 1. 安装依赖

```bash
# 安装前端依赖
npm install

# 或者使用 yarn
yarn install
```

### 2. 安装Tauri CLI（如果尚未安装）

```bash
# 通过 cargo 安装
cargo install tauri-cli

# 或者通过 npm 安装
npm install -g @tauri-apps/cli
```

### 3. 开发模式运行

```bash
# 启动开发服务器
npm run tauri dev

# 或者
yarn tauri dev
```

### 4. 构建生产版本

```bash
# 构建应用程序
npm run tauri build

# 或者
yarn tauri build
```

## 项目结构

```
tauri-shadcn-vite-template/
├── src/                          # 前端源代码
│   ├── components/              # React组件
│   │   ├── ui/                 # shadcn/ui 基础组件
│   │   │   ├── sidebar.tsx     # 侧边栏组件
│   │   │   ├── tabs.tsx        # 标签页组件
│   │   │   ├── card.tsx        # 卡片组件
│   │   │   ├── checkbox.tsx    # 复选框组件
│   │   │   └── ...             # 其他UI组件
│   │   ├── export-tab.tsx      # 导出功能页面
│   │   ├── file-browser.tsx    # 文件浏览器组件
│   │   └── ...
│   ├── App.tsx                 # 主应用组件
│   └── main.tsx                # 入口文件
├── src-tauri/                   # Tauri后端
│   ├── src/
│   │   └── main.rs             # Rust主文件
│   ├── Cargo.toml              # Rust依赖配置
│   └── tauri.conf.json         # Tauri配置
└── package.json                # Node.js依赖配置
```

## 主要功能模块

### 1. 文件浏览器 (`src/components/file-browser.tsx`)
- 文件夹和文件的可视化展示
- 支持多选功能
- 压缩选项UI（针对文件夹）
- 文件大小显示

### 2. 导出功能 (`src/components/export-tab.tsx`)
- 文件夹选择器（调用系统文件管理器）
- 导出配置管理（包名、下载前缀、版本）
- 批量选择和清空功能
- 导出进度管理

### 3. Rust后端 (`src-tauri/src/main.rs`)
- 文件系统操作（读取文件夹内容）
- SHA256哈希计算
- ZIP文件创建和压缩
- JSON清单生成
- 异步文件处理

## 重要的Tauri命令

### `get_folder_contents`
获取指定文件夹的内容列表

```rust
#[tauri::command]
async fn get_folder_contents(path: String) -> Result<Vec<FileItem>, String>
```

### `export_files`
导出选中的文件和文件夹

```rust
#[tauri::command]
async fn export_files(files: Vec<FileItem>, settings: ExportSettings) -> Result<String, String>
```

## 导出功能特性

### 智能压缩
- ✅ 用户可选择是否压缩文件夹
- ✅ 支持嵌套ZIP（压缩的文件夹作为ZIP嵌入主ZIP）
- ✅ 减轻服务器解压压力

### 清单生成
导出的ZIP包含`manifest.json`文件，结构如下：

```json
{
  "package_name": "游戏包名",
  "version": "1.0.0",
  "created_at": "2024-01-01T00:00:00Z",
  "files": [
    {
      "name": "文件名.txt",
      "download_url": "https://example.com/downloads/文件名.txt",
      "relative_path": "folder/文件名.txt",
      "hash": "sha256哈希值",
      "size": 1024
    }
  ]
}
```

## 开发说明

### 添加新的UI组件
所有UI组件基于shadcn/ui构建，位于`src/components/ui/`目录。

### 修改Rust后端
Rust代码位于`src-tauri/src/main.rs`，修改后需要重新编译。

### 调试模式
开发模式下，Tauri会自动重新编译Rust代码和前端代码。

## 故障排除

### 常见问题

1. **Rust编译失败**
   ```bash
   # 更新Rust工具链
   rustup update
   
   # 清理构建缓存
   cargo clean
   ```

2. **前端依赖问题**
   ```bash
   # 删除node_modules并重新安装
   rm -rf node_modules
   npm install
   ```

3. **Tauri权限问题**
   检查`src-tauri/tauri.conf.json`中的`allowlist`配置是否正确。

### 日志查看
开发模式下，可以在浏览器开发者工具和终端中查看日志。

## 后续开发计划

- [ ] 添加下载同步功能
- [ ] 实现文件差异检测
- [ ] 添加进度条和状态指示器
- [ ] 支持更多压缩格式
- [ ] 添加配置文件持久化

## 技术栈

- **前端**: React 18 + TypeScript + Vite
- **UI框架**: shadcn/ui + Tailwind CSS
- **桌面框架**: Tauri
- **后端**: Rust
- **依赖管理**: npm/yarn + Cargo

## 许可证

本项目基于MIT许可证开源。
